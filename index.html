<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physio Routine App</title>
  <style>
    /* Global Styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Arial, sans-serif;
      background: #f7faff;
      color: #333;
      padding: 1rem;
      max-width: 600px;
      margin: auto;
    }
    button { padding: 0.6rem; font-size: 1rem; }
    select, input { padding: 0.5rem; font-size: 1rem; margin-bottom: 0.5rem; width: 100%; }
    h1, h2 { margin-bottom: 1rem; }
    .hidden { display: none; }
    .exercise-item { padding: 0.5rem; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; }
    .controls button { margin: 0.2rem; }
    .active { display: block; }
    .view { display: none; }
    .progress { margin-top: 1rem; text-align: center; font-size: 1.2rem; }
    svg { width: 100px; height: 100px; margin: auto; display: block; }
    .offline { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1>Physio Routine App</h1>
    <button id="toggleView">Exercise Player</button>
    <span id="offlineStatus" class="offline">Works offline</span>
  </header>

  <main>
    <!-- Routine Builder -->
    <section id="builderView" class="view active">
      <h2>Routine Builder</h2>
      <select id="exerciseSelect"></select>
      <input type="number" id="reps" placeholder="Repetitions (e.g., 5)">
      <input type="number" id="duration" placeholder="Duration (seconds)">
      <input type="number" id="cycles" placeholder="Cycles (e.g., 2)">
      <button id="addExercise">Add to Routine</button>

      <div id="routineList"></div>

      <button id="saveRoutine">Save Routine</button>
      <button id="startRoutine">Start Routine</button>
    </section>

    <!-- Exercise Player -->
    <section id="playerView" class="view">
      <h2 id="currentExerciseName">Exercise Name</h2>
      <div id="exerciseSvg"></div>
      <div class="progress">
        <p id="repCounter"></p>
        <p id="cycleCounter"></p>
        <p id="timer"></p>
      </div>
      <div class="controls">
        <button id="prev">Prev</button>
        <button id="playPause">Pause</button>
        <button id="next">Next</button>
      </div>
    </section>
  </main>

<script>
  (function(){
    "use strict";

    const exercises = [
      {id: 1, name: "Shoulder Stretch", svg: `<svg><circle cx="50" cy="50" r="40" stroke="blue" fill="none"><animate attributeName="r" values="30;40;30" dur="2s" repeatCount="indefinite"/></circle></svg>`},
      {id: 2, name: "Knee Flexion", svg: `<svg><rect width="80" height="80" stroke="red" fill="none"><animate attributeName="height" values="60;80;60" dur="2s" repeatCount="indefinite"/></rect></svg>`},
      {id: 3, name: "Ankle Circles", svg: `<svg><circle cx="50" cy="50" r="30" stroke="green" fill="none"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="2s" repeatCount="indefinite"/></circle></svg>`},
      {id: 4, name: "Back Extension", svg: `<svg><line x1="10" y1="10" x2="90" y2="90" stroke="purple"><animate attributeName="x2" values="90;60;90" dur="2s" repeatCount="indefinite"/></line></svg>`},
      {id: 5, name: "Neck Tilts", svg: `<svg><ellipse cx="50" cy="50" rx="30" ry="20" stroke="orange" fill="none"><animate attributeName="rx" values="20;30;20" dur="2s" repeatCount="indefinite"/></ellipse></svg>`},
    ];

    let currentRoutine = JSON.parse(localStorage.getItem('routine')) || [];
    let currentExerciseIndex = 0;
    let timer, secondsLeft, isPaused = false;

    const els = {
      toggleView: document.getElementById('toggleView'),
      builderView: document.getElementById('builderView'),
      playerView: document.getElementById('playerView'),
      exerciseSelect: document.getElementById('exerciseSelect'),
      reps: document.getElementById('reps'),
      duration: document.getElementById('duration'),
      cycles: document.getElementById('cycles'),
      addExercise: document.getElementById('addExercise'),
      routineList: document.getElementById('routineList'),
      saveRoutine: document.getElementById('saveRoutine'),
      startRoutine: document.getElementById('startRoutine'),
      currentExerciseName: document.getElementById('currentExerciseName'),
      exerciseSvg: document.getElementById('exerciseSvg'),
      repCounter: document.getElementById('repCounter'),
      cycleCounter: document.getElementById('cycleCounter'),
      timer: document.getElementById('timer'),
      prev: document.getElementById('prev'),
      next: document.getElementById('next'),
      playPause: document.getElementById('playPause'),
    };

    function init() {
      exercises.forEach(ex => {
        const option = document.createElement('option');
        option.value = ex.id;
        option.textContent = ex.name;
        els.exerciseSelect.appendChild(option);
      });
      els.addExercise.onclick = addExerciseToRoutine;
      els.saveRoutine.onclick = () => localStorage.setItem('routine', JSON.stringify(currentRoutine));
      els.startRoutine.onclick = startRoutine;
      els.toggleView.onclick = () => {
        els.builderView.classList.toggle('active');
        els.playerView.classList.toggle('active');
      };
      els.playPause.onclick = () => isPaused = !isPaused;
      els.next.onclick = () => nextExercise(1);
      els.prev.onclick = () => nextExercise(-1);
      renderRoutine();
      navigator.serviceWorker.register('data:application/javascript;base64,Ly8gc3R1YiBzd29yayBmb3Igc2luZ2xlIGZpbGUgUHdB');
    }

    function addExerciseToRoutine(){
      const ex = exercises.find(e => e.id == els.exerciseSelect.value);
      currentRoutine.push({ ...ex, reps: els.reps.value, duration: els.duration.value, cycles: els.cycles.value });
      renderRoutine();
    }

    function renderRoutine(){
      els.routineList.innerHTML = '';
      currentRoutine.forEach((ex,i)=>{
        const div = document.createElement('div');
        div.className = 'exercise-item';
        div.innerHTML = `${ex.name} (${ex.reps} reps, ${ex.duration}s, ${ex.cycles} cycles) <button onclick="this.parentElement.remove();currentRoutine.splice(${i},1)">Remove</button>`;
        els.routineList.appendChild(div);
      });
    }

    function startRoutine(){
      els.builderView.classList.remove('active');
      els.playerView.classList.add('active');
      currentExerciseIndex = 0;
      playExercise();
    }

    function playExercise(){
      if(currentExerciseIndex >= currentRoutine.length) return;
      const ex = currentRoutine[currentExerciseIndex];
      els.currentExerciseName.textContent = ex.name;
      els.exerciseSvg.innerHTML = ex.svg;
      secondsLeft = ex.duration;
      els.repCounter.textContent = `Reps: ${ex.reps}`;
      els.cycleCounter.textContent = `Cycle: 1/${ex.cycles}`;
      timer = setInterval(()=>{
        if(!isPaused && --secondsLeft >= 0) els.timer.textContent = `${secondsLeft}s`;
        else if(secondsLeft<0) nextExercise(1);
      },1000);
    }

    function nextExercise(dir){ clearInterval(timer); currentExerciseIndex+=dir; playExercise(); }

    window.onload = init;
  })();
</script>
</body>
</html>
